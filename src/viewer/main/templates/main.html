<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" >
    <title>{{param.title}}</title>
    <style type="text/css" title="currentStyle">
      @import "/static/media/css/demo_table.css";

    select {
      margin: 0 2;
    }
    #date_now {
      font-size: 20;
      text-align: center;
    }
    .year_statistic {
      text-align: center;
      font-size: 18;
      color: blue;
      background-color: yellow;
    }
    #zen_x_red {
      float: right;
      margin-right: 5;
    }
    .year_statistic td {
      text-align: center;
    }
    </style>
    <script type="text/javascript" src="/static/media/js/jquery.js"></script>
    <script type="text/javascript" src="/static/media/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="/static/js/dateTables.plugins.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
        var oTable = $('#list_table').dataTable({
          "oLanguage": {
            "sUrl": "/static/js/dataTable.oLanguage.txt"
          },
          "aLengthMenu": [[25, 50, 100, -1], [25, 50, 100, "Todos"]],
          "bAutoWidth": false,
          "bStateSave": true,
          "iDisplayLength": 25,
    
      "aoColumns": [
        {% for header in  headers %}
          {"sTitle": "{{ header }}", "sClass":{% ifequal header "Assunto" %}"left"{% else %}"center"{% endifequal %} },
        {% endfor %}
      ],
    
      "aaData": [
        {% for slist in rlist %} [
          {% for item in slist %}
            {% if item.link and item.label %}'<a href="{{item.link}}" target="_blank">{{item.label}}</a>'
            {% else %}"{{ item }}"{% endif %},
          {% endfor %}],
        {% endfor %}]
      });
    
    var report = new function() {
      this.nsp = {
        check_status: function() {
          var total_hours = "{{params.statistic.total_hours}}"
          var yearlyRemainder = "{{params.statistic.yearly_remainder}}"
          var monthlyRemainder = "{{params.statistic.remainder}}"
          var yearlyActive = "{{params.statistic.yearlyplan.is_active}}"
          var msg = "";
          
          var m_valid = "{{params.statistic.checkMonthYear}}"
          var total = parseFloat(total_hours.replace(",","."))
          var y_remainder = parseFloat(yearlyRemainder.replace(",","."));
          var m_remainder = parseFloat(monthlyRemainder.replace(",","."));
          var y_report = parseInt("{{params.yearly_report}}")
          
          if (yearlyActive == "True") {
            if (y_remainder < 0.0 && y_report) {
              msg = "O máximo de horas para esse 'plano anual', já foram alcançadas."
            } else {
              if (m_remainder < 0.0) {
                msg = "O máximo de horas para esse 'plano mensal', já foram alcançadas."
              }
              if (total <= 0.0 && m_valid == "True") {
                msg = "O total de horas para esse mês é menor ou igual a zero."
                msg += "\n  Contate o administrado para resolver o problema."
              }
            }
            if ( msg ) alert( msg );
          }
        },
        // desativa um objeto(element), marcando o checkbox alvo.
        disable : function(element_id, checkbox) {
          if (element_id[0] != "#") element_id = "#"+element_id
          var object = $( element_id );
          if ($( checkbox ).is(":checked")) {
            object.attr('disabled', 'disabled');
          } else {
            object.removeAttr('disabled');
          }
        },
        init: function() {
          var _this = this;
          var checkbox = $("#yearly_report");
          
          checkbox.click(function() {
            _this.disable("id_period_month", this);
          });
          
          this.disable("id_period_month", checkbox);
          // faz a verifiação dos dados do relatório.
          setTimeout(this.check_status, 1000);
        }
      }
    }
    report.nsp.init();
    });
  </script>
</head>

<body>
  <div id="toolbar">
    <form name="input" action="" method="get" accept-charset="utf-8">
      Projetos:
      <select name="project_id"/>
        {% for key, value in projects %}
          <option value="{{key}}" {% if params.project_id_selected == key%} selected="selected"{% endif %}>{{value}}</option>
        {% endfor %}
      </select>
      Periodo: {% for field in dateInputForm %}{{ field }}{% endfor %}
      Ano completo: <input type="checkbox" id="yearly_report" name="yearly_report" value="1" {% if params.yearly_report %}checked{%endif%}/>
      Com detalhes: <input type="checkbox" id="detail_view" name="detail_view" value="1" {% if params.detail_view %}checked{%endif%}/>
      <input type="submit" value="Pesquisar"/>

      <div id="zen_x_red">
        <a href="{% url viewer.zenapp.views.report_load %}">Zendesk</a>&nbsp;
        <a href="{% url viewer.redapp.views.report_load %}">Redmine</a>
      </div>
    
    </form>
  </div>

  <div id="date_now"><b>{{date_now}}</b></div>
  {% include "top_msg.html" %}
  
  <div id="viewer_table">
    <table cellpadding="0" cellspacing="0" border="0" class="display" id="list_table"></table>
  </div>
  
  {% include "bottom_msg.html" %}
</body>
</html>

